
<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>لوحة التحكم</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&amp;display=swap" rel="stylesheet"/>
<style>
    body { font-family: 'Tajawal', sans-serif; }
  </style>
</head>
<body class="bg-background text-foreground">
<div class="flex h-screen">
<!-- الشريط الجانبي -->
<aside class="w-64 h-screen max-md:hidden bg-white border-l border-gray-200 flex flex-col">
<div class="p-6">
<h2 class="text-xl font-bold text-blue-600">نظام الإدارة</h2>
</div>
<nav class="flex-1 px-4">
<ul class="space-y-2">
<li>
<a class="flex items-center p-3 rounded-lg hover:bg-gray-100" href="#">
<span class="ml-3 text-xl">🧭</span><span>لوحة التحكم</span>
</a>
</li>
<li>
<a class="flex items-center p-3 rounded-lg bg-blue-50 text-blue-600" href="#">
<span class="ml-3 text-xl">👤</span><span>المستخدمين</span>
</a>
</li>
</ul>
</nav>
<div class="p-4 border-t border-gray-200">
<button class="flex items-center w-full p-3 rounded-lg text-red-500 hover:bg-red-50">
<svg class="ml-3 h-5 w-5" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4m7 10l5-5m0 0l-5-5m5 5H9" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
<span>تسجيل الخروج</span>
</button>
</div>
</aside>
<!-- المحتوى الرئيسي -->
<main class="flex-1 overflow-auto">
<div class="p-4 border-b flex justify-between items-center bg-white">
<h1 class="text-xl font-bold md:hidden">المستخدمين</h1>
<div class="flex items-center gap-2">
<button class="relative rounded-full w-9 h-9 hover:bg-gray-100">
<svg class="h-5 w-5" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"></path>
<path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"></path>
</svg>
<span class="absolute top-0 right-0 h-4 w-4 rounded-full bg-red-500 text-[10px] font-medium text-white flex items-center justify-center">0</span>
</button>
</div>
</div>
<div class="p-6">
<div class="mb-6">
<h1 class="text-2xl font-bold mb-2 hidden md:block">المستخدمين</h1>
<p class="text-gray-500">إدارة بيانات المستخدمين</p>
</div>
<div class="flex flex-col md:flex-row justify-between gap-4 md:items-center mb-6">
<div class="relative w-full max-w-md">
<svg class="absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
<circle cx="11" cy="11" r="8"></circle>
<path d="M21 21l-4.3-4.3"></path>
</svg>
<input class="w-full pr-10 pl-4 h-10 border rounded-lg focus:border-blue-400 focus:ring focus:ring-blue-200 focus:ring-opacity-50 text-sm" placeholder="بحث برقم الهوية أو التسلسلي" type="search"/>
</div>
<button class="h-10 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-full flex items-center gap-2" id="addUserBtn">
<svg class="ml-2 h-4 w-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
<circle cx="12" cy="12" r="10"></circle>
<path d="M8 12h8"></path>
<path d="M12 8v8"></path>
</svg>
            إضافة مستخدم جديد
          </button>
</div>
<div class="rounded-lg border bg-white shadow-sm">
<div class="overflow-auto">
<table class="w-full text-sm" id="usersTable">
<thead class="bg-gray-100">
<tr class="border-b">
<th class="px-4 py-2 text-right font-bold text-gray-500">رقم الهوية</th>
<th class="px-4 py-2 text-right font-bold text-gray-500">الرقم التسلسلي</th>
<th class="px-4 py-2 text-right font-bold text-gray-500">الملف</th>
<th class="px-4 py-2 text-right font-bold text-gray-500">تعديل</th>
<th class="px-4 py-2 text-right font-bold text-gray-500">حذف</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</div>
</div>
</div>
</main>
</div>
<!-- Modal -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden" id="userModal">
<div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6">
<h2 class="text-xl font-bold mb-4">إضافة مستخدم جديد</h2>
<form class="space-y-4" id="userForm">
<div>
<label class="block mb-1 font-medium">رقم الهوية (10 أرقام)</label>
<input class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring focus:border-blue-400" id="identityInput" maxlength="10" pattern="\d{10}" required="" type="text"/>
</div>
<div>
<label class="block mb-1 font-medium">الرقم التسلسلي (أرقام فقط)</label>
<input class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring focus:border-blue-400" id="serialInput" pattern="\d+" required="" type="text"/>
</div>
<div>
<label class="block mb-1 font-medium">تحميل الملف</label>
<input class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring focus:border-blue-400" id="fileInput" required="" type="file"/>
</div>
<div class="flex justify-end gap-2">
<button class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400" id="cancelBtn" type="button">إلغاء</button>
<button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" type="submit">إضافة</button>
</div>
</form>
</div>
</div>

<script>
  const modal = document.getElementById("userModal");
  const form = document.getElementById("userForm");

  document.getElementById("addUserBtn").onclick = () => modal.classList.remove("hidden");
  document.getElementById("cancelBtn").onclick = () => modal.classList.add("hidden");

  async function loadUsers() {
    const res = await fetch('/users');
    const users = await res.json();
    const tbody = document.querySelector("#usersTable tbody");
    tbody.innerHTML = "";
    users.forEach(user => {
      const tr = document.createElement("tr");
      tr.className = "border-b hover:bg-gray-50";
      tr.innerHTML = `
        <td class="px-4 py-2">${user.id}</td>
        <td class="px-4 py-2">${user.serial}</td>
        <td class="px-4 py-2"><a href="/uploads/${user.file}" target="_blank" class="text-blue-500 hover:underline">عرض</a></td>
        <td class="px-4 py-2 text-blue-500 cursor-pointer" onclick="alert('ميزة التعديل لم تُفعل بعد')">تعديل</td>
        <td class="px-4 py-2 text-red-500 cursor-pointer" onclick="deleteUser('${user.id}', '${user.serial}')">حذف</td>
      `;
      tbody.appendChild(tr);
    });
  }

  async function deleteUser(id, serial) {
    if (!confirm("هل أنت متأكد من حذف المستخدم؟")) return;
    await fetch('/delete-user', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ id, serial })
    });
    loadUsers();
  }

  form.onsubmit = async (e) => {
    e.preventDefault();
    const id = document.getElementById("identityInput").value;
    const serial = document.getElementById("serialInput").value;
    const file = document.getElementById("fileInput").files[0];
    if (!/\d{10}/.test(id)) return alert("رقم الهوية يجب أن يكون 10 أرقام.");
    if (!/\d+/.test(serial)) return alert("الرقم التسلسلي يجب أن يكون أرقام فقط.");
    if (!file) return alert("يرجى اختيار ملف.");

    const formData = new FormData();
    formData.append("id", id);
    formData.append("serial", serial);
    formData.append("file", file);

    await fetch('/upload', {
      method: 'POST',
      body: formData
    });

    modal.classList.add("hidden");
    form.reset();
    loadUsers();
  };

  window.onload = loadUsers;
</script>
</body>
</html>
